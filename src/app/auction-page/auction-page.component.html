<div class="content-container">
  <div class="content-block" [ngClass]="{ 'no-active': !account }">
    <div class="content-block_title">
      <span>Auction</span>
      <div
        class="question"
        mat-raised-button
        matTooltip="Provide Ethereum and get the chance to buy Axion for lower than Uniswap rate"
        matTooltipClass="question__tooltip"
      ></div>
    </div>

    <form
      #sendForm="ngForm"
      class="blocks-list blocks-list__small-size blocks-list__full-width"
    >
      <div class="form-auction">
        <div class="form-auction__item">
          <span class="form-auction__item-title">auction pool</span>
          <div class="form-auction__item-blocks">
            <div class="form-auction__item-blocks__item">
              <span class="form-auction__item-blocks__item-value">{{
                poolInfo.axn
              }}</span>
              <span
                class="form-auction__item-blocks__item-icon cl-red-light icon icon__axion"
                >AXN</span
              >
            </div>
            <div class="form-auction__item-blocks__item">
              <span class="form-auction__item-blocks__item-value">{{
                poolInfo.eth || 0
              }}</span>
              <span
                class="form-auction__item-blocks__item-icon icon icon__eth-purple"
                >ETH</span
              >
            </div>
          </div>
          <div class="form-auction__item-rates">
            <div class="form-auction__item-rates__item cl-purple">
              <span
                class="form-auction__item-rates__item-icon cl-white icon icon__axion"
                >1 Axn</span
              >
              <span class="form-auction__item-rates__item-text">=</span>
              <span
                class="form-auction__item-rates__item-icon icon icon__eth-purple"
                >{{ poolInfo.axnToEth || 0 }}</span
              >
            </div>
            <div class="form-auction__item-rates__item cl-gray">
              <span
                class="form-auction__item-rates__item-icon icon icon__axion-gray"
                >1 Axn</span
              >
              <span class="form-auction__item-rates__item-text">=</span>
              <span
                class="form-auction__item-rates__item-icon icon icon__eth-gray"
                >{{ poolInfo.uniToEth || 0 }}</span
              >
            </div>
          </div>
        </div>
        <div class="form-auction__item">
          <span class="form-auction__item-title__light">Input</span>
          <input
            type="text"
            *ngIf="account"
            required="required"
            class="form-auction__item-input"
            placeholder="0.0"
            [appBigNumber]="{
              decimals: tokensDecimals['ETH'],
              min: 1,
              max: account?.balances.ETH.wei
            }"
            [maxValueChange]="onChangeAccount"
            [(ngModel)]="formsData.auctionAmount"
            name="swap-amount"
            autocomplete="off"
          />
          <span class="form-auction__item-amount-icon icon icon__eth-purple"
            >ETH</span
          >
          <div class="form-auction__item-actions">
            <div class="form-auction__item-actions-amount">
              <span
                (click)="
                  formsData.auctionAmount = account?.balances.ETH.shortBigNumber.toString()
                "
                class="form-auction__item-actions-amount-btn"
                >Send max</span
              >
              <span class="form-auction__item-actions-amount-text"
                >Balance {{ account?.balances?.ETH.display }}</span
              >
            </div>
            <button
              class="btn btn__normal btn__normal-img"
              [ngClass]="{ progress: sendAuctionProgress }"
              [disabled]="sendForm.invalid || sendAuctionProgress"
              (click)="sendETHToAuction()"
            >
              <span class="lds-ellipsis" *ngIf="sendAuctionProgress">
                <span class="lds-ellipsis-container">
                  <span></span><span></span><span></span><span></span>
                </span>
              </span>
              <span>SEND</span>
              <img src="assets/images/styling/arrow-right.svg" alt="" />
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="content-block generated-link" *ngIf="account">
    <div *ngIf="referalAddress" class="generated-link-used">
      <span class="generated-link-used-text"
        >Referrer address: {{ referalAddress }}</span
      >
      <span class="generated-link-used-button" (click)="resetRef()">reset</span>
    </div>

    <div class="generated-link-user">
      <button
        (click)="generateRefLink()"
        class="generated-link-btn"
        *ngIf="referalLink === ''"
      >
        Generate referral link
      </button>
      <input
        class="generated-link-text"
        *ngIf="referalLink != ''"
        (click)="$event.target.select()"
        readonly
        [value]="referalLink"
      />
      <button
        *ngIf="referalLink != ''"
        class="generated-link-btn-copy"
        ngxClipboard
        [cbContent]="referalLink"
        (cbOnSuccess)="onCopied()"
      >
        Copy
      </button>
      <div
        class="question"
        mat-raised-button
        matTooltip="Share your referral link and get extra 20% from your referrer, referrer gets extra 10% Axion"
        matTooltipClass="question__tooltip"
      ></div>
      <span style="font-size: 10px; margin-left: 10px" *ngIf="addressCopy">
        address copied
      </span>
    </div>
  </div>

  <div class="content-block" *ngIf="account && auctionsList?.length">
    <div class="content-block_title text-left">
      <span>Your Auctions</span>
    </div>
    <table
      class="standard-table text-left"
      cellpadding="0"
      cellspacing="0"
      border="0"
    >
      <thead class="text-left">
        <tr>
          <th
            (click)="sortAuctions('start')"
            class="as-sort"
            [ngClass]="{
              active: currentSort['field'] === 'start',
              ask: currentSort['ask']
            }"
          >
            Date
            <span class="sort-indicator"></span>
          </th>
          <th
            (click)="sortAuctions('token')"
            class="as-sort"
            [ngClass]="{
              active: currentSort['field'] === 'token',
              ask: currentSort['ask']
            }"
          >
            AXN in pool
            <span class="sort-indicator"></span>
          </th>
          <th
            (click)="sortAuctions('eth')"
            class="as-sort"
            [ngClass]="{
              active: currentSort['field'] === 'eth',
              ask: currentSort['ask']
            }"
          >
            ETH in pool
            <span class="sort-indicator"></span>
          </th>
          <th
            (click)="sortAuctions('accountTokenBalance')"
            class="as-sort"
            [ngClass]="{
              active: currentSort['field'] === 'accountTokenBalance',
              ask: currentSort['ask']
            }"
          >
            My bet ETH
            <span class="sort-indicator"></span>
          </th>
          <th
            (click)="sortAuctions('accountTokenBalance')"
            class="as-sort"
            [ngClass]="{
              active: currentSort['field'] === 'accountTokenBalance',
              ask: currentSort['ask']
            }"
          >
            Your Winnings
            <span class="sort-indicator"></span>
          </th>
          <th width="10">&nbsp;</th>
        </tr>
      </thead>
      <tbody class="text-left">
        <tr *ngFor="let auction of auctionsList">
          <td>{{ auction.start_date | date: "dd.MM.yyyy" }}</td>
          <td>
            {{
              auction.axn_pool
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:4
            }}
          </td>
          <td>
            {{
              auction.eth_pool
                | bigNumberFormat: tokensDecimals["ETH"]:true:false:4
            }}
          </td>
          <td>
            {{
              auction.eth_bet
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:4
            }}
          </td>
          <td [colSpan]="auction.winnings === 0 ? 2 : 1">
            {{
              auction.winnings
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:4
            }}
          </td>
          <td class="action-button" *ngIf="auction.winnings !== 0">
            <button
              class="btn btn__transparent"
              (click)="auctionWithdraw(auction)"
              [ngClass]="{ progress: auction.withdrawProgress }"
              [disabled]="auction.withdrawProgress"
            >
              <span class="lds-ellipsis" *ngIf="auction.withdrawProgress">
                <span class="lds-ellipsis-container">
                  <span></span><span></span><span></span><span></span>
                </span>
              </span>
              <span>&nbsp;&nbsp;WITHDRAW&nbsp;&nbsp;</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
