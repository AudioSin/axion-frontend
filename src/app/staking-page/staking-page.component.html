<div class="content-container">
  <div class="content-block" [ngClass]="{ 'no-active': !account }">
    <div class="content-block_title">
      <span>Create deposit</span>
      <div
        class="question"
        mat-raised-button
        matTooltip="Stake Axion and get Shares, to participate in daily dividends distribution"
        matTooltipClass="question__tooltip"
      ></div>
    </div>
    <div class="blocks-list without-arrow_separator">
      <form
        #depositForm="ngForm"
        class="staking-form"
        [ngClass]="{ disabled: depositTokensProgress }"
      >
        <div class="staking-form__item staking-form__item-deposit">
          <div class="staking-form__item-deposit__item-first">
            <span class="staking-form__item-title cl-aqua"
              >Enter depoist amount</span
            >
            <input
              *ngIf="account"
              type="text"
              class="staking-form__item-input cl-aqua"
              autocomplete="off"
              required="required"
              [appBigNumber]="{
                decimals: tokensDecimals['HEX2X'],
                min: 1,
                max: account?.balances.HEX2X.wei
              }"
              name="deposit-amount"
              placeholder="0.0"
              (ngModelChange)="onChangeAmount()"
              [maxValueChange]="onChangeAccount"
              [(ngModel)]="formsData.depositAmount"
              autocomplete="off"
            />
            <div class="staking-form__item-icon-wrap">
              <span
                class="staking-form__item-icon cl-red-light icon icon__axion"
                >AXN</span
              >
            </div>
            <div class="staking-form__item-actions">
              <div class="staking-form__item-actions-amount">
                <span
                  (click)="
                    formsData.depositAmount = account?.balances.HEX2X.shortBigNumber.toString();
                    onChangeAmount()
                  "
                  class="staking-form__item-actions-amount-btn"
                  >Send max</span
                >
                <span class="staking-form__item-actions-amount-text"
                  >Balance {{ account?.balances?.HEX2X.display }}</span
                >
              </div>
            </div>
          </div>
          <div class="staking-form__item-deposit__item">
            <span class="staking-form__item-title">Set deposit period</span>
            <input
              class="staking-form__item-input cl-white"
              type="number"
              step="1"
              autocomplete="off"
              [appMinMaxNumber]="{
                min: 1,
                max: depositMaxDays
              }"
              min="1"
              (ngModelChange)="onChangeAmount()"
              [max]="depositMaxDays"
              placeholder="1"
              required="required"
              name="deposit-days"
              [(ngModel)]="formsData.depositDays"
              autocomplete="off"
            />
            <div class="staking-form__item-actions">
              <div class="staking-form__item-actions-amount">
                <span class="staking-form__item-actions-amount-btn">{{
                  [null, "", 0, 1].includes(formsData.depositDays)
                    ? "DAY"
                    : "DAYS"
                }}</span>
              </div>
              <span class="staking-form__item-text"
                >ENDS {{ stakeDays | date: "dd.MM.y" }}
              </span>
            </div>
          </div>
        </div>
        <div class="staking-form__item">
          <span class="staking-form__item-title" style="text-align: center"
            >Shares</span
          >
          <hr />
          <div class="staking-form__item-shares">
            <div class="staking-form__item-shares__item">
              <span class="staking-form__item-shares__item-value">
                {{ shareRate || 0 }}</span
              >
              <span class="staking-form__item-shares__item-text"
                >Share rate
                {{
                  stakingContractInfo.ShareRate
                    | bigNumberFormat: tokensDecimals.HEX2X:true:false:4 || 0
                }}
              </span>
            </div>
            <div class="staking-form__item-shares__item">
              <span class="staking-form__item-shares__item-text"
                >Longer Pays <br />
                Better</span
              >
              <span class="staking-form__item-shares__item-value">{{
                bonusLongerPays
                  | bigNumberFormat: tokensDecimals.HEX2X:true:false:4
              }}</span>
            </div>
          </div>
          <button
            class="btn btn__normal uppercase nowrap"
            (click)="openDeposit()"
            [ngClass]="{ progress: depositTokensProgress }"
            [disabled]="depositForm.invalid || depositDaysInvalid"
          >
            <span class="lds-ellipsis" *ngIf="depositTokensProgress">
              <span class="lds-ellipsis-container">
                <span></span><span></span><span></span><span></span>
              </span>
            </span>
            <span>Deposit</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="content-block" *ngIf="tableInfo && bpd[4].show && account">
    <div style="margin: 30px 0" class="content-block_title text-center">
      <span>Big Pay Day</span>
      <div
        class="question"
        mat-raised-button
        matTooltip="Stake for more than 350 days and participate in Big Pay Day Pool token distribution"
        matTooltipClass="question__tooltip"
      ></div>
    </div>
    <table class="standard-table" cellpadding="0" cellspacing="0" border="0">
      <thead>
        <tr>
          <ng-container *ngFor="let item of bpd">
            <th *ngIf="item.show">{{ item.daysLeft }} Days left</th>
          </ng-container>
        </tr>
      </thead>
      <tbody>
        <tr>
          <ng-container *ngFor="let item of bpd">
            <td *ngIf="item.show">
              {{ item.value | number }}
              <span class="icon icon__axion-small icon-flex cl-red-light"
                >AXN</span
              >
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    class="content-block"
    *ngIf="depositsLists?.opened.length && tokensDecimals"
  >
    <div class="content-block_title text-left">
      <span>Opened deposits</span>
    </div>
    <table class="standard-table" cellpadding="0" cellspacing="0" border="0">
      <thead>
        <tr>
          <th>Start date</th>
          <th>End date</th>
          <th>Progress</th>
          <th>Principal</th>
          <th>Shares</th>
          <th>BigPayDay</th>
          <th>Interest</th>
          <th width="10">&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let deposit of depositsLists.opened">
          <td>{{ deposit.start | date: "dd.MM.yyyy" }}</td>
          <td>{{ deposit.end | date: "dd.MM.yyyy" }}</td>
          <td>{{ getProgress(deposit) }}%</td>
          <td>
            {{
              deposit.amount
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}&nbsp;AXN
          </td>
          <td>
            {{
              deposit.shares
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}
          </td>
          <td>
            {{
              deposit.bigPayDay
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}&nbsp;AXN
          </td>
          <td>
            {{
              deposit.interest
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}
          </td>
          <td class="action-button">
            <button
              class="btn btn__transparent"
              (click)="depositWithdraw(deposit)"
              [ngClass]="{ progress: deposit.withdrawProgress }"
              [disabled]="deposit.withdrawProgress"
            >
              <span class="lds-ellipsis" *ngIf="deposit.withdrawProgress">
                <span class="lds-ellipsis-container">
                  <span></span><span></span><span></span><span></span>
                </span>
              </span>
              <span>&nbsp;&nbsp;Withdraw&nbsp;&nbsp;</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    class="content-block"
    *ngIf="depositsLists?.closed.length && tokensDecimals && account"
  >
    <div class="content-block_title text-left">
      <span>Deposit history</span>
    </div>
    <table class="standard-table" cellpadding="0" cellspacing="0" border="0">
      <thead>
        <tr>
          <th>Start date</th>
          <th>End date</th>
          <th>Principal</th>
          <th>Shares</th>
          <th>BigPayDay</th>
          <th>Interest</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let deposit of depositsLists.closed">
          <td>{{ deposit.start | date: "dd.MM.yyyy" }}</td>
          <td>{{ deposit.end | date: "dd.MM.yyyy" }}</td>
          <td>
            {{
              deposit.amount
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}
          </td>
          <td>
            {{
              deposit.shares
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}
          </td>
          <td>
            {{
              deposit.bigPayDay
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}&nbsp;AXN
          </td>
          <td>
            {{
              deposit.interest
                | bigNumberFormat: tokensDecimals["HEX2X"]:true:false:2
            }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
